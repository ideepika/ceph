---
name: "Create Backport"
on:
  pull_request:
    types: [ closed ]
env:
  #FIX: org change
  redmine_user_id: dupadhya
  redmine_key: "${{ secrets.REDMINE_KEY }}"
  github_user: ideepika
  github_token: "${{ secrets.GITHUB_TOKEN }}"
  fork_remote: https://github.com/ideepika/ceph.git
jobs:
  merge_job:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Check commit message
        run: |
          echo PR #${{ github.event.number }} has been merged
          echo ${{ toJSON(github.event.pull_request.head.sha) }}
          echo ${{ toJSON(github.event.pull_request) }}
          echo ::set-env name=commitmsg_temp::$(git log --format=%B -n 1 ${{ github.event.pull_request.head.sha }})
          echo ::set-env name=commitmsg::$(git log --format=%B -n 1 ${{ github.event.after }})
          echo "temp " $commitmsg_temp
          echo "real " $commitmsg
          tracker_id=$(echo $commitmsg_temp | grep "tracker.ceph" | cut -d"/" -f5)
          echo $tracker_id
          tracker_id=$(echo $commitmsg | grep "tracker.ceph" | cut -d"/" -f5)
          echo $tracker_id
          #      - name: Update issues with PR ID
          #        run: ./src/script/backport-create-issue () --force --resolve-parent
          #
          #
          #
          #
          #      - name: Update Tracker
          #          #      - name: set tracker to PR id
          #          #        if: "!contains(github.event.pull_request.commits, 'tracker.ceph')
          #

        #TODO
